<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cn" lang="cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>数据库缓存类 - CodeIgniter 中文手册</title>
<link rel="stylesheet" type="text/css" media="all" href="../userguide.css" />
<link rel="search" href="http://codeigniter.org.cn/CodeIgniterSearch.xml" type="application/opensearchdescription+xml" title="CodeIgniter 搜索"/>
<script type="text/javascript" src="../nav/nav.js"></script>
<script type="text/javascript" src="../nav/prototype.lite.js"></script>
<script type="text/javascript" src="../nav/moo.fx.js"></script>
<script type="text/javascript" src="../nav/user_guide_menu.js"></script>
<meta name="robots" content="all" />
<meta name="author" content="ExpressionEngine Dev Team" />
<meta name="description" content="CodeIgniter 中文手册, CodeIgniter 用户指南, CodeIgniter User Guide, Wiki 文档" />
</head>
<body>
<!-- START NAVIGATION -->
<div id="nav">
  <div id="nav_inner">
    <script type="text/javascript">create_menu('../');</script>
  </div>
</div>
<div id="nav2"><a name="top"></a><a href="javascript:void(0);" onclick="myHeight.toggle();"><img src="../images/nav_toggle.jpg" width="153" height="44" border="0" title="切换目录" alt="切换目录" /></a></div>
<div id="masthead">
  <table cellpadding="0" cellspacing="0" border="0" style="width:100%">
    <tr>
      <td width="350"><h1>CodeIgniter 用户指南 版本 1.6.3</h1></td>
      <td id="breadcrumb_right"><a href="../toc.html">目录页</a></td>
    </tr>
  </table>
</div>
<!-- END NAVIGATION -->
<!-- START BREADCRUMB -->
<table cellpadding="0" cellspacing="0" border="0" style="width:100%">
  <tr>
    <td id="breadcrumb">
		<a href="http://codeigniter.org.cn/" target="_blank">CodeIgniter 中国首页</a>&nbsp;&#8250;&nbsp;
<a href="../index.html">用户指南首页</a>&nbsp;&#8250;&nbsp;<a href="index.html">数据库类</a>&nbsp;&#8250;&nbsp;数据库缓存类	</td>
    <td id="searchbox">
		<form method="get" action="http://www.google.com/search" target="google_window">
		<input type="hidden" name="client" value="pub-0176846097796333"></input>
		<input type="hidden" name="forid" value="1"></input>
		<input type="hidden" name="ie" value="UTF-8"></input>
		<input type="hidden" name="oe" value="UTF-8"></input>
        <input type="hidden" name="as_sitesearch" id="as_sitesearch" value="codeigniter.org.cn/user_guide/" />
        搜索用户指南&nbsp;
        <input type="text" class="input" style="width:200px;" name="q" id="q" size="31" maxlength="255" value="" />
        &nbsp;
        <input type="submit" class="submit" name="sa" value="Go" />
      </form>
	</td>
  </tr>
</table>
<!-- END BREADCRUMB -->
<!--<br clear="all" />-->
<!-- START CONTENT -->
<div id="content">
<h1>数据库缓存类</h1>

<p>数据库缓存类允许你把数据库查询结果保存在文本文件中以减少数据库访问。</p>

<p class="important"><strong>重要提示：</strong>&nbsp; 本类在激活后会随数据库驱动自动初始化。<b>切勿</b>手动加载。<br /><br />

<strong>另：</strong>&nbsp; 并非所有查询结果都能被缓存。请仔细阅读本页内容。</p>

<h2>激活缓存</h2>

<p>激活缓存需要三步：</p>

<ul>
<li>在服务器上创建一个可写的目录以便保存缓存文件。</li>
<li>在文件 <dfn>application/config/database.php</dfn> 中设置其目录。</li>

<li>激活缓存特性，可以在文件 <dfn>application/config/database.php</dfn> 中设置全局选项，也可以用以本页下面的方法手动设置。</li>
</ul>

<p>一旦被激活，每一次含有数据库查询的页面被加载时缓存就会自动发生。</p>


<h2>缓存如何工作？</h2>

<p>当页面被浏览时CodeIgniter的查询缓存系统能够动态执行。如果缓存特性被激活，那么在此页面首次被加载时，数据库查询的结果对象将会被序列化并保存在你服务器的文本文件中。而页面再次被加载时缓存文件将会替代数据库查询。如此，在被缓存的页面中，你的数据库使用率会降至0。</p>

<p>只有 <dfn>读类型(read-type)</dfn> (SELECT) 查询会被缓存，因为只有这种查询会产生结果集。
<dfn>写类型(Write-type)</dfn> (INSERT, UPDATE, 等等) 查询，因为不会产生结果集，故缓存系统不对之进行缓存。</p>

<p>缓存文件<b>不会</b>过期，除非你删掉，否则任何被缓存了的查询会一直存在。缓存系统允许你按页面清除，或把所有缓存都清除掉。一般来说，你可以在某些事件(比如向数据库添加了数据)发生时用下面的函数来清除缓存。</p>

<h2>缓存能够提升站点的性能吗？</h2>

<p>Getting a performance gain as a result of caching depends on many factors.
If you have a highly optimized database under very little load, you probably won't see a performance boost.
If your database is under heavy use you probably will see an improved response, assuming your file-system is not
overly taxed.  Remember that caching simply changes how your information is retrieved, shifting it from being a database
operation to a file-system one.</p>

<p>In some clustered server environments, for example, caching may be detrimental since file-system operations are so intense.
On single servers in shared environments, caching will probably be beneficial. Unfortunately there is no
single answer to the question of whether you should cache your database.  It really depends on your situation.</p>

<h2>How are Cache Files Stored?</h2>

<p>CodeIgniter places the result of EACH query into its own cache file.  Sets of cache files are further organized into
sub-folders corresponding to your controller functions.  To be precise, the sub-folders are named identically to the
first two segments of your URI (the controller class name and function name).</p>

<p>For example, let's say you have a controller called <dfn>blog</dfn> with a function called <dfn>comments</dfn> that
contains three queries.  The caching system will create a cache folder
called <kbd>blog+comments</kbd>, into which it will write three cache files.</p>

<p>If you use dynamic queries that change based on information in your URI (when using pagination, for example), each instance of
the query will produce its own cache file.  It's possible, therefore, to end up with many times more cache files than you have
queries.</p>


<h2>Managing your Cache Files</h2>

<p>Since cache files do not expire, you'll need to build deletion routines into your application.  For example, let's say you have a blog
that allows user commenting.  Whenever a new comment is submitted you'll want to delete the cache files associated with the
controller function that serves up your comments.  You'll find two delete functions described below that help you
clear data.</p>


<h2>Not All Database Functions Work with Caching</h2>

<p>Lastly, we need to point out that the result object that is cached is a simplified version of the full result object. For that reason,
some of the query result functions are not available for use.</p>

<p>The following functions <kbd>ARE NOT</kbd> available when using a cached result object:</p>

<ul>
<li>num_fields()</li>
<li>field_names()</li>
<li>field_data()</li>
<li>free_result()</li>
</ul>

<p>Also, the two database resources (result_id and conn_id) are not available when caching, since result resources only
pertain to run-time operations.</p>


<br />

<h1>Function Reference</h1>



<h2>$this-&gt;db-&gt;cache_on()&nbsp; / &nbsp; $this-&gt;db-&gt;cache_off()</h2>

<p>Manually enables/disables caching.  This can be useful if you want to
keep certain queries from being cached.  Example:</p>

<code>
// Turn caching on<br />
$this-&gt;db-&gt;cache_on();<br />
$query = $this-&gt;db-&gt;query("SELECT * FROM mytable");<br />
<br />
// Turn caching off for this one query<br />
$this-&gt;db-&gt;cache_off();<br />
$query = $this-&gt;db-&gt;query("SELECT * FROM members WHERE member_id = '$current_user'");<br />

<br />
// Turn caching back on<br />
$this-&gt;db-&gt;cache_on();<br />
$query = $this-&gt;db-&gt;query("SELECT * FROM another_table");
</code>


<h2>$this-&gt;db-&gt;cache_delete()</h2>

<p>Deletes the cache files associated with a particular page. This is useful if you need to clear caching after you update your database.</p>

<p>The caching system saves your cache files to folders that correspond to the URI of the page you are viewing.  For example, if you are viewing
a page at <dfn>example.com/index.php/blog/comments</dfn>, the caching system will put all cache files associated with it in a folder
called <dfn>blog+comments</dfn>.  To delete those particular cache files you will use:</p>

<code>$this-&gt;db-&gt;cache_delete('blog', 'comments');</code>

<p>If you do not use any parameters the current URI will be used when determining what should be cleared.</p>


<h2>$this-&gt;db-&gt;cache_delete_all()</h2>

<p>Clears all existing cache files.  Example:</p>

<code>$this-&gt;db-&gt;cache_delete_all();</code><p>&nbsp;</p>
<div id="Contributors">
翻译贡献者:
Hex, iptton</div>
<div id="DocDate">最后修改: 2008-06-28 02:22:46</div>
</div>
<!-- END CONTENT -->
<div id="footer">
  <p>
上一个主题:&nbsp;&nbsp;<a href="../database/call_function.html">自定义函数调用</a>&nbsp;&nbsp;&middot;&nbsp;&nbsp;<a href="#top">页首</a>
&nbsp;&middot;&nbsp;&nbsp;<a href="../index.html">用户指南首页</a>&nbsp;&nbsp;&middot;&nbsp;&nbsp;下一个主题:&nbsp;&nbsp;<a href="../database/utilities.html">数据库工具类</a>  </p>
  <p><a href="http://codeigniter.com" target="_blank">CodeIgniter</a> &nbsp;&middot;&nbsp; 版权所有 &#169; 2006-2008 &nbsp;&middot;&nbsp; <a href="http://ellislab.com/" target="_blank">Ellislab, Inc.</a></p>
  <p>中文化: <a href="http://codeigniter.org.cn" target="_blank">CodeIgniter 中国</a> &nbsp;&middot;&nbsp; 制作: Hex &nbsp;&middot;&nbsp; 生成日期: 2008-09-22 01:15</p>
</div>
</body>
</html>