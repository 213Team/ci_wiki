<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cn" lang="cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Active Record 模式 - CodeIgniter 中文手册</title>
<link rel="stylesheet" type="text/css" media="all" href="../userguide.css" />
<link rel="search" href="http://codeigniter.org.cn/CodeIgniterSearch.xml" type="application/opensearchdescription+xml" title="CodeIgniter 搜索"/>
<script type="text/javascript" src="../nav/nav.js"></script>
<script type="text/javascript" src="../nav/prototype.lite.js"></script>
<script type="text/javascript" src="../nav/moo.fx.js"></script>
<script type="text/javascript" src="../nav/user_guide_menu.js"></script>
<meta name="robots" content="all" />
<meta name="author" content="ExpressionEngine Dev Team" />
<meta name="description" content="CodeIgniter 中文手册, CodeIgniter 用户指南, CodeIgniter User Guide, Wiki 文档" />
</head>
<body>
<!-- START NAVIGATION -->
<div id="nav">
  <div id="nav_inner">
    <script type="text/javascript">create_menu('../');</script>
  </div>
</div>
<div id="nav2"><a name="top"></a><a href="javascript:void(0);" onclick="myHeight.toggle();"><img src="../images/nav_toggle.jpg" width="153" height="44" border="0" title="切换目录" alt="切换目录" /></a></div>
<div id="masthead">
  <table cellpadding="0" cellspacing="0" border="0" style="width:100%">
    <tr>
      <td width="350"><h1>CodeIgniter 用户指南 版本 1.6.3</h1></td>
      <td id="breadcrumb_right"><a href="../toc.html">目录页</a></td>
    </tr>
  </table>
</div>
<!-- END NAVIGATION -->
<!-- START BREADCRUMB -->
<table cellpadding="0" cellspacing="0" border="0" style="width:100%">
  <tr>
    <td id="breadcrumb">
		<a href="http://codeigniter.org.cn/" target="_blank">CodeIgniter 中国首页</a>&nbsp;&#8250;&nbsp;
<a href="../index.html">用户指南首页</a>&nbsp;&#8250;&nbsp;<a href="index.html">数据库类</a>&nbsp;&#8250;&nbsp;Active Record 模式	</td>
    <td id="searchbox">
		<form method="get" action="http://www.google.com/search" target="google_window">
		<input type="hidden" name="client" value="pub-0176846097796333"></input>
		<input type="hidden" name="forid" value="1"></input>
		<input type="hidden" name="ie" value="UTF-8"></input>
		<input type="hidden" name="oe" value="UTF-8"></input>
        <input type="hidden" name="as_sitesearch" id="as_sitesearch" value="codeigniter.org.cn/user_guide/" />
        搜索用户指南&nbsp;
        <input type="text" class="input" style="width:200px;" name="q" id="q" size="31" maxlength="255" value="" />
        &nbsp;
        <input type="submit" class="submit" name="sa" value="Go" />
      </form>
	</td>
  </tr>
</table>
<!-- END BREADCRUMB -->
<!--<br clear="all" />-->
<!-- START CONTENT -->
<div id="content">
<h1>Active Record 类</h1>


<p>CodeIgniter 使用的是修改过的Active Record数据库模式。
这种模式是以较少的程序代码来实现信息在数据库中的获取，插入，更改。
有时只用一两行的代码就能完成对数据库的操作。
CodeIgniter不需要每一个数据库表拥有自己的类。它提供了一个跟简单的借口。</p>

<p>不只是简单，使用Active Record的一个主要的优点是允许你创建独立的数据库应用程序，因为查询语法是由数据库的适配器来产生的。它可以进行更安全的查询，因为系统会自动的对所有的输入值进行转义。</p>

<p class="important"><strong>注意:</strong>  你如果想要写自己的查询表达式，可以在数据库配置文件中禁止这个类。同时相比 Active Record，使用核心数据库类库和适配器将会使用更少资源。<br /></p>


<ul>
<li><a href="#select">选择数据</a></li>
<li><a href="#insert">插入数据</a></li>
<li><a href="#update">更新数据</a></li>
<li><a href="#delete">删除数据</a></li>
<li><a href="#chaining">链式方法</a></li>
<li><a href="#caching">Active Record 缓存</a></li>
</ul>



<a name="select">&nbsp;</a>
<h1>选择数据</h1>

<p>下面的函数帮助你构建SQL<strong>SELECT</strong>语句。</p>

<p><strong>备注：如果你正在使用 PHP5，你可以在复杂情况下使用链式语法。本页面底部有具体描述。</strong></p>


<h2>$this-&gt;db-&gt;get();</h2>

<p>运行选择查询语句并且返回结果集。可以获取一个表的全部数据。</p>

<code>$query = $this-&gt;db-&gt;get('mytable');<br />
<br />
// Produces: SELECT * FROM mytable</code>

<p>第二和第三个参数允许你设置一个结果集每页纪录数(limit)和结果集的偏移(offset)</p>

<code>$query = $this-&gt;db-&gt;get('mytable', 10, 20);<br />
<br />
// Produces: SELECT * FROM mytable LIMIT 20, 10 (in MySQL. Other databases have slightly different syntax)</code>

<p>注意：第二参数是每页纪录数，第三个参数是偏移</p>
<p>你会注意到上面的函数由一个变量<kbd>$query</kbd>执行，这个<kbd>$query</kbd>可以用来显示结果集。</p>

<code>$query = $this-&gt;db-&gt;get('mytable');<br />
<br />
foreach ($query-&gt;result() as $row)<br />
&#123;<br />
&nbsp;&nbsp;&nbsp;&nbsp;echo $row-&gt;title;<br />

&#125;</code>

<p>请访问<a href="results.html">查询结果</a>页查看详细的生成结果的方法。</p>

<h2>$this-&gt;db-&gt;get_where();</h2>

<p>跟上面的函数一样，只是它允许你在函数的第二个参数那里添加一个 where 从句，从而不用使用 db-&gt;where() 这个函数：</p>

<code>$query = $this-&gt;db-&gt;get_where('mytable', array('id' => $id), $limit, $offset);</code>

<p>请阅读下面的 where 函数了解更多。</p>
<p class="important">注意: get_where() 在以前的版本中写作 getwhere()，这是已经过时的用法。</p>

<h2>$this-&gt;db-&gt;select();</h2>
<p>允许你在SQL查询中写 SELECT 部分:</p>
<p><code>
$this-&gt;db-&gt;select('title, content, date');<br />
<br />
$query = $this-&gt;db-&gt;get('mytable');<br />
<br />

// Produces: SELECT title, content, date FROM mytable</code></p>
<p class="important"><strong>注意:</strong> 如果你你要查询表中的所有行，你可以不用写这个函数。省略后，CodeIgniter 会认为你要查询
全部行(SELECT *)。</p>

<p>$this-&gt;db-&gt;select() 可接受一个可选的第二个参数。如果你把它设为FALSE， CodeIgniter 将不会使用反引号保护你的字段或者表名
。这在进行复合查询时很有用。</p>
<p><code>   $this-&gt;db-&gt;select('(SELECT SUM(payments.amount) FROM payments WHERE payments.invoice_id=4') AS amount_paid', FALSE); <br />
    $query = $this-&gt;db-&gt;get('mytable');<br />

</code></p>
<h2>$this-&gt;db-&gt;select_max();</h2>
<p>为你的查询编写一个 "SELECT MAX(field)"。你可以选择性的给出第二个参数，以便重命名结果字段名。</p>
<p><code>
$this-&gt;db-&gt;select_max('age');<br />
$query = $this-&gt;db-&gt;get('members');<br />

// Produces: SELECT MAX(age) as age FROM members<br />
<br />
$this-&gt;db-&gt;select_max('age', 'member_age');<br />

$query = $this-&gt;db-&gt;get('members');<br />
// Produces: SELECT MAX(age) as member_age FROM members</code></p>

<h2>$this-&gt;db-&gt;select_min();</h2>
<p>Writes a "SELECT MIN(field)" portion for your query. As with <dfn>select_max()</dfn>, You can optionally include a second parameter to rename the resulting field.</p>
<p><code>
$this-&gt;db-&gt;select_min('age');<br />
$query = $this-&gt;db-&gt;get('members');<br />

// Produces: SELECT MIN(age) as age FROM members</code></p>

<h2>$this-&gt;db-&gt;select_avg();</h2>
<p>Writes a "SELECT AVG(field)" portion for your query. As with <dfn>select_max()</dfn>, You can optionally include a second parameter to rename the resulting field.</p>
<p><code>
$this-&gt;db-&gt;select_avg('age');<br />
$query = $this-&gt;db-&gt;get('members');<br />
// Produces: SELECT AVG(age) as age FROM members</code></p>

<h2>$this-&gt;db-&gt;select_sum();</h2>
<p>Writes a "SELECT SUM(field)" portion for your query. As with <dfn>select_max()</dfn>, You can optionally include a second parameter to rename the resulting field.</p>
<p><code>
$this-&gt;db-&gt;select_sum('age');<br />
$query = $this-&gt;db-&gt;get('members');<br />
// Produces: SELECT SUM(age) as age FROM members</code></p>

<h2>$this-&gt;db-&gt;from();</h2>

<p>Permits you to write the FROM portion of your query:</p>

<code>
$this-&gt;db-&gt;select('title, content, date');<br />
$this-&gt;db-&gt;from('mytable');<br />
<br />
$query = $this-&gt;db-&gt;get();<br />
<br />
// Produces: SELECT title, content, date FROM mytable</code>

<p class="important">Note: As shown earlier, the FROM portion of your query can be specified in the <dfn>$this-&gt;db-&gt;get()</dfn> function, so use whichever method
you prefer.</p>

<h2>$this-&gt;db-&gt;join();</h2>

<p>Permits you to write the JOIN portion of your query:</p>

<code>
$this-&gt;db-&gt;select('*');<br />
$this-&gt;db-&gt;from('blogs');<br />
$this-&gt;db-&gt;join('comments', 'comments.id = blogs.id');<br />
<br />
$query = $this-&gt;db-&gt;get();<br />

<br />
// Produces: <br />
// SELECT * FROM blogs<br />
// JOIN comments ON comments.id = blogs.id<br />
</code>

<p>Multiple function calls can be made if you need several joins in one query.</p>

<p>If you need something other than a natural JOIN you can specify it via the third parameter of the function.
Options are: left, right, outer, inner, left outer, and right outer.</p>

<code>
$this-&gt;db-&gt;join('comments', 'comments.id = blogs.id', <strong>'left'</strong>);<br />

<br />
// Produces: LEFT JOIN comments ON comments.id = blogs.id</code>





<h2>$this-&gt;db-&gt;where();</h2>
<p>This function enables you to set <strong>WHERE</strong> clauses using one of four methods:</p>

<p class="important"><strong>Note:</strong> All values passed to this function are escaped automatically, producing safer queries.</p>

<ol>
 <li><strong>Simple key/value method:</strong>

 <code>$this-&gt;db-&gt;where('name', $name);
 <br /><br />// Produces: WHERE name = 'Joe'
 </code>
 
 <p>Notice that the equal sign is added for you.</p>
 
 <p>If you use multiple function calls they will be chained together with <var>AND</var> between them:</p>

 
 <code>$this-&gt;db-&gt;where('name', $name);<br />
 $this-&gt;db-&gt;where('title', $title);<br />
 $this-&gt;db-&gt;where('status', $status);
 <br /><br />// WHERE name = 'Joe' AND title = 'boss' AND status = 'active'
 </code>
 

 </li>
 
 <li><strong>Custom key/value method:</strong>
 
 <p>You can include an operator in the first parameter in order to control the comparison:</p>

 
 <code>$this-&gt;db-&gt;where('name !=', $name);<br />
 $this-&gt;db-&gt;where('id <', $id);
 <br /><br />// Produces: WHERE name != 'Joe' AND id < 45</code></li>

 <li><strong>Associative array method:</strong>

 <code>
 $array = array('name' => $name, 'title' => $title, 'status' => $status);<br /><br />
 
 $this-&gt;db-&gt;where($array);
 <br /><br />// Produces: WHERE name = 'Joe' AND title = 'boss' AND status = 'active'
 </code>

 <p>You can include your own operators using this method as well:</p>

 <code>

 $array = array('name !=' => $name, 'id <' => $id, 'date >' => $date);<br /><br />
 
 $this-&gt;db-&gt;where($array);</code>

 </li>
  <li><strong>Custom string:</strong>
  
  <p>You can write your own clauses manually:</p>

  <code>
  $where = "name='Joe' AND status='boss' OR status='active'";<br /><br />
  $this-&gt;db-&gt;where($where);</code>

 </li>
</ol>

<p>$this-&gt;db-&gt;where() accepts an optional third parameter. If you set it to FALSE, CodeIgniter will not try to protect your field or table names with backticks.</p>
<p><code>   $this-&gt;db-&gt;where('MATCH (field) AGAINST (&quot;value&quot;)', NULL, FALSE);<br />
</code></p>

<h2>$this-&gt;db-&gt;or_where();</h2>
<p>This function is identical to the one above, except that multiple instances are joined by OR:</p>

<code>
$this-&gt;db-&gt;where('name !=', $name);<br />
$this-&gt;db-&gt;or_where('id >', $id);
<br />
<br />// Produces: WHERE name != 'Joe' OR id > 50</code>

<p class="important">Note: or_where() was formerly known as orwhere(), which has been deprecated.</p>


<h2>$this-&gt;db-&gt;where_in();</h2>
<p>Generates a WHERE field IN ('item', 'item') SQL query joined with  AND if appropriate</p>

<p><code>
    $names = array('Frank', 'Todd', 'James');<br />
    $this-&gt;db-&gt;where_in('username', $names);<br />
    // Produces: WHERE username IN ('Frank', 'Todd', 'James')</code></p>

<h2>$this-&gt;db-&gt;or_where_in();</h2>
<p>Generates a WHERE field IN ('item', 'item') SQL query joined with OR if appropriate</p>
<p><code>
    $names = array('Frank', 'Todd', 'James');<br />

    $this-&gt;db-&gt;or_where_in('username', $names);<br />
    // Produces: OR username IN ('Frank', 'Todd', 'James')</code></p>
    
<h2>$this-&gt;db-&gt;where_not_in();</h2>
<p>Generates a WHERE field NOT IN ('item', 'item') SQL query joined with AND if appropriate</p>
<p><code>
    $names = array('Frank', 'Todd', 'James');<br />
    $this-&gt;db-&gt;where_not_in('username', $names);<br />

    // Produces: WHERE username NOT IN ('Frank', 'Todd', 'James')</code></p>

<h2>$this-&gt;db-&gt;or_where_not_in();</h2>
<p>Generates a WHERE field NOT IN ('item', 'item') SQL query joined with OR if appropriate</p>
<p><code>
    $names = array('Frank', 'Todd', 'James');<br />
    $this-&gt;db-&gt;or_where_not_in('username', $names);<br />
    // Produces: OR username NOT IN ('Frank', 'Todd', 'James')</code></p>

<h2>$this-&gt;db-&gt;like();</h2>
<p>This function enables you to generate <strong>LIKE</strong> clauses, useful for doing searches.</p>

<p class="important"><strong>Note:</strong> All values passed to this function are escaped automatically.</p>


<ol>
 <li><strong>Simple key/value method:</strong>

 <code>$this-&gt;db-&gt;like('title', 'match');
 <br /><br />// Produces: WHERE title LIKE '&#xma;tch%' </code>
  
 <p>If you use multiple function calls they will be chained together with <var>AND</var> between them:</p>
 
 <code>$this-&gt;db-&gt;like('title', 'match');<br />
 $this-&gt;db-&gt;like('body', 'match');
 <br /><br />

 // WHERE title LIKE '&#xma;tch%' AND  body LIKE '&#xma;tch%</code>
 If you want to control where the wildcard (%) is placed, you can use an optional third argument. Your options are 'before', 'after' and 'both' (which is the default). 
 <code>$this-&gt;db-&gt;like('title', 'match', 'before');
 <br />
  // Produces: WHERE title LIKE '&#xma;tch' <br />
     <br />
 $this-&gt;db-&gt;like('title', 'match', 'after'); <br />

// Produces: WHERE title LIKE 'match%' <br />
<br />
 $this-&gt;db-&gt;like('title', 'match', 'both'); <br />
// Produces: WHERE title LIKE '&#xma;tch%' </code> </li>
 
 <li><strong>Associative array method:</strong>

 <code>

 $array = array('title' => $match, 'page1' => $match, 'page2' => $match);<br /><br />
 
 $this-&gt;db-&gt;like($array);
 <br /><br />// WHERE title LIKE '&#xma;tch%' AND  page1 LIKE '&#xma;tch%' AND  page2 LIKE '&#xma;tch%'</code></li>
    </ol>
 
 
<h2>$this-&gt;db-&gt;or_like();</h2>
<p>This function is identical to the one above, except that multiple instances are joined by OR:</p>

<code>
$this-&gt;db-&gt;like('title', 'match');<br />

$this-&gt;db-&gt;or_like('body', $match);
<br />
<br />// WHERE title LIKE '&#xma;tch%' OR  body LIKE '&#xma;tch%'</code>



 
<p class="important">Note: or_like() was formerly known as orlike(), which has been deprecated.</p>
<h2>$this-&gt;db-&gt;not_like();</h2>
<p>This function is identical to <strong>like()</strong>, except that it generates NOT LIKE statements:</p>

<code> $this-&gt;db-&gt;not_like('title', 'match');<br />
<br />
// WHERE title NOT LIKE '&#xma;tch%</code>
<h2>$this-&gt;db-&gt;or_not_like();</h2>
<p>This function is identical to <strong>not_like()</strong>, except that multiple instances are joined by OR:</p>
<code> $this-&gt;db-&gt;like('title', 'match');<br />

$this-&gt;db-&gt;or_not_like('body', 'match'); <br />
<br />
// WHERE title  LIKE '&#xma;tch% OR body NOT LIKE '&#xma;tch%'</code>
<h2>$this-&gt;db-&gt;group_by();</h2>
<p>Permits you to write the GROUP BY portion of your query:</p>
 
<code>$this-&gt;db-&gt;group_by("title");
<br /><br />// Produces: GROUP BY title
</code>

<p>You can also pass an array of multiple values as well:</p>

 
<code>$this-&gt;db-&gt;group_by(array("title", "date"));
<br />
<br />// Produces: GROUP BY title, date</code>
 
<p class="important">Note: group_by() was formerly known as groupby(), which has been deprecated. </p>

<h2> $this-&gt;db-&gt;distinct();<br />
</h2>
<p>Adds the &quot;DISTINCT&quot; keyword to a query</p>

<p><code>$this-&gt;db-&gt;distinct();<br />
    $this-&gt;db-&gt;get('table');<br />
        <br />
    // Produces: SELECT DISTINCT * FROM table</code></p>
<h2>$this-&gt;db-&gt;having();</h2>
<p>Permits you to write the HAVING portion of your query. There are 2 possible syntaxe, 1 argument or 2:</p>

 
<code>$this-&gt;db-&gt;having('user_id = 45');
<br />
// Produces: HAVING user_id = 45<br />
<br />
$this-&gt;db-&gt;having('user_id',  45); <br />
// Produces: HAVING user_id = 45<br />
<br />
</code>
 
<p>You can also pass an array of multiple values as well:</p>


<p><code>$this-&gt;db-&gt;having(array('title =' => 'My Title', 'id <' => $id)); <br />
  <br />
 // Produces: HAVING title = 'My Title', id < 45</code></p>
<p>If you are using a database that CodeIgniter escapes queries for, you can prevent escaping content by passing an optional third argument, and setting it to FALSE.</p>
<p><code>$this-&gt;db-&gt;having('user_id',  45); <br />
// Produces: HAVING `user_id` = 45 in some databases such as MySQL
  <br />
  $this-&gt;db-&gt;having('user_id',  45, FALSE); <br />
// Produces: HAVING user_id = 45</code></p>
 
 
<h2>$this-&gt;db-&gt;or_having();</h2>
<p>Identical to having(), only separates multiple clauses with &quot;OR&quot;.</p>
<h2>$this-&gt;db-&gt;order_by();</h2>
<p>Lets you set an ORDER BY clause. The first parameter contains the name of the column you would like to order by.
The second parameter lets you set the direction of the result.  Options are <kbd>asc</kbd> or <kbd>desc</kbd>, or <kbd>random</kbd>. </p>

 
<code>$this-&gt;db-&gt;order_by("title", "desc");
<br />
<br />// Produces: ORDER BY title DESC
</code>

<p>You can also pass your own string in the first parameter:</p>
 
<code>$this-&gt;db-&gt;order_by('title desc, name asc');
<br />
<br />// Produces: ORDER BY title DESC, name ASC
</code>

<p>Or multiple function calls can be made if you need multiple fields.</p>

<p><code>$this-&gt;db-&gt;order_by("title", "desc");<br />
    $this-&gt;db-&gt;order_by("name", "asc"); <br />
    <br />
    // Produces: ORDER BY title DESC, name ASC
    </code></p>
<p class="important">Note: order_by() was formerly known as orderby(), which has been deprecated.</p>
<p class="important">Note: random ordering is not currently supported in Oracle or MSSQL drivers. These will default to 'ASC'.</p>
<h2>$this-&gt;db-&gt;limit();</h2>
<p>Lets you limit the number of rows you would like returned by the query:</p>

<code>
$this-&gt;db-&gt;limit(10);<br />
<br />
// Produces: LIMIT 10</code>


<p>The second parameter lets you set a result offset.</p>

<code>
$this-&gt;db-&gt;limit(10, 20);<br />
<br />
// Produces: LIMIT 20, 10 (in MySQL.  Other databases have slightly different syntax)</code>


<h2>$this-&gt;db-&gt;count_all_results();</h2>

<p>Permits you to determine the number of rows in a particular Active Record query. Queries will accept Active Record restrictors such as where(),  or_where(), like(), or_like(), etc. Example:</p>
<code>echo $this-&gt;db-&gt;count_all_results('<var>my_table</var>');<br />

// Produces an integer, like 25<br />
<br />
$this-&gt;db-&gt;like('title', 'match');<br />

$this-&gt;db-&gt;from('<var>my_table</var>');<br />
echo $this-&gt;db-&gt;count_all_results();<br />
// Produces an integer, like 17 </code>

<h2>$this-&gt;db-&gt;count_all();</h2>

<p>Permits you to determine the number of rows in a particular table.  Submit the table name in the first parameter. Example:</p>

<code>echo $this-&gt;db-&gt;count_all('<var>my_table</var>');<br />
<br />
// Produces an integer, like 25</code>


 
<a name="insert">&nbsp;</a>
<h1>Inserting Data</h1>
 
<h2>$this-&gt;db-&gt;insert();</h2>

<p>Generates an insert string based on the data you supply, and runs the query. You can either pass an
<strong>array</strong> or an <strong>object</strong> to the function.  Here is an example using an array:</p>

<code>
$data = array(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'title' => 'My title' ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'name' => 'My Name' ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'date' => 'My date'<br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />
<br />
$this-&gt;db-&gt;insert('mytable', $data);
<br /><br />
// Produces: INSERT INTO mytable (title, name, date) VALUES ('My title', 'My name', 'My date')</code>

<p>The first parameter will contain the table name, the second is an associative array of values.</p>

<p>Here is an example using an object:</p>

<code>
/*<br />

&nbsp;&nbsp;&nbsp;&nbsp;class Myclass &#123;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $title = 'My Title';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $content = 'My Content';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $date = 'My Date';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&#125;<br />
*/<br />
<br />
$object = new Myclass;<br />
<br />
$this-&gt;db-&gt;insert('mytable', $object);

<br /><br />
// Produces: INSERT INTO mytable (title, content, date) VALUES ('My Title', 'My Content', 'My Date')</code>

<p>The first parameter will contain the table name, the second is an associative array of values.</p>

<p class="important"><strong>Note:</strong> All values are escaped automatically producing safer queries.</p>
 
 
 

<h2>$this-&gt;db-&gt;set();</h2>
<p>This function enables you to set values for <dfn>inserts</dfn> or <dfn>updates</dfn>.</p>

<p><strong>It can be used instead of passing a data array directly to the insert or update functions:</strong> </p>

<code>$this-&gt;db-&gt;set('name', $name);
<br />
$this-&gt;db-&gt;insert('mytable');
<br /><br />
// Produces: INSERT INTO mytable (name) VALUES ('&#123;$name&#125;')</code>

<p>If you use multiple function called they will be assembled properly based on whether you are doing an insert or an update:</p>

<code>$this-&gt;db-&gt;set('name', $name);<br />

$this-&gt;db-&gt;set('title', $title);<br />
$this-&gt;db-&gt;set('status', $status);<br />
$this-&gt;db-&gt;insert('mytable'); </code>
<p><strong>set()</strong> will also accept an optional third parameter ($escape), that will prevent data from being escaped if set to FALSE. To illustrate the difference, here is set() used both with and without the escape parameter.</p>
<p><code>$this-&gt;db-&gt;set('field', 'field+1', FALSE);<br />

    $this-&gt;db-&gt;insert('mytable'); <br />
    // gives INSERT INTO mytable (field) VALUES (field+1)<br />
    <br />
    $this-&gt;db-&gt;set('field', 'field+1');<br />
    $this-&gt;db-&gt;insert('mytable'); <br />

    // gives INSERT INTO mytable (field) VALUES ('field+1')</code></p>
<p>You can also pass an associative array to this function:</p>
<code>
$array = array('name' => $name, 'title' => $title, 'status' => $status);<br /><br />

$this-&gt;db-&gt;set($array);<br />
$this-&gt;db-&gt;insert('mytable');
</code>

<p>Or an object:</p>

<code>
/*<br />
&nbsp;&nbsp;&nbsp;&nbsp;class Myclass &#123;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $title = 'My Title';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $content = 'My Content';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $date = 'My Date';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&#125;<br />
*/<br />
<br />

$object = new Myclass;<br />
<br />
$this-&gt;db-&gt;set($object);<br />
$this-&gt;db-&gt;insert('mytable');
</code>


 
<a name="update">&nbsp;</a>
<h1>Updating Data</h1>
 
<h2>$this-&gt;db-&gt;update();</h2>
<p>Generates an update string and runs the query based on the data you supply.  You can pass an

<strong>array</strong> or an <strong>object</strong> to the function. Here is an example using
an array:</p>

<code>
$data = array(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'title' => $title,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'name' => $name,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'date' => $date<br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />
<br />
$this-&gt;db-&gt;where('id', $id);<br />
$this-&gt;db-&gt;update('mytable', $data);
<br /><br />
// Produces:<br />
// UPDATE mytable <br />
// SET title = '&#123;$title&#125;', name = '&#123;$name&#125;', date = '&#123;$date&#125;'<br />
// WHERE id = $id</code>

<p>Or you can supply an object:</p>

<code>
/*<br />
&nbsp;&nbsp;&nbsp;&nbsp;class Myclass &#123;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $title = 'My Title';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $content = 'My Content';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var  $date = 'My Date';<br />
&nbsp;&nbsp;&nbsp;&nbsp;&#125;<br />
*/<br />
<br />

$object = new Myclass;<br />
<br />
$this-&gt;db-&gt;where('id', $id);<br />
$this-&gt;db-&gt;update('mytable', $object);
<br />
<br />
// Produces:<br />
// UPDATE mytable <br />
// SET title = '&#123;$title&#125;', name = '&#123;$name&#125;', date = '&#123;$date&#125;'<br />
// WHERE id = $id</code>


<p class="important"><strong>Note:</strong> All values are escaped automatically producing safer queries.</p>
 
<p>You'll notice the use of the <dfn>$this-&gt;db-&gt;where()</dfn> function, enabling you to set the WHERE clause.
You can optionally pass this information directly into the update function as a string:</p>

<code>$this-&gt;db-&gt;update('mytable', $data, "id = 4");</code>

<p>Or as an array:</p>

<code>$this-&gt;db-&gt;update('mytable', $data, array('id' => $id));</code>
 
<p>You may also use the <dfn>$this-&gt;db-&gt;set()</dfn> function described above when performing updates.</p>

 
<a name="delete">&nbsp;</a>
<h1>Deleting Data</h1>


 

<h2>$this-&gt;db-&gt;delete();</h2>
<p>Generates a delete SQL string and runs the query.</p>

<code>
$this-&gt;db-&gt;delete('mytable', array('id' => $id));
<br /><br />
// Produces:<br />
// DELETE FROM mytable <br />
// WHERE id = $id</code>

<p>The first parameter is the table name, the second is the where clause. You can also use the <dfn>where()</dfn> or <dfn>or_where()</dfn> functions instead of passing
the data to the second parameter of the function:</p>

<p><code> $this-&gt;db-&gt;where('id', $id);<br />
    $this-&gt;db-&gt;delete('mytable'); <br />
    <br />
    // Produces:<br />
    // DELETE FROM mytable <br />
    // WHERE id = $id</code></p>

<p>An array of table names can be passed into delete() if you would like to delete data from more then 1 table.</p>
<p><code>$tables = array('table1', 'table2', 'table3');<br />
$this-&gt;db-&gt;where('id', '5');<br />
$this-&gt;db-&gt;delete($tables);</code></p>
<p>If you want to delete all data from a table, you can use the <dfn>truncate()</dfn> function, or <dfn>empty_table()</dfn>.</p>

<h2>$this-&gt;db-&gt;empty_table();</h2>
<p>Generates a delete SQL string and runs the query.<code>    $this-&gt;db-&gt;empty_table('mytable'); <br />
    <br />
// Produces<br />
// DELETE FROM mytable</code></p>
<h2>$this-&gt;db-&gt;truncate();</h2>

<p>Generates a truncate SQL string and runs the query.</p>
<code> $this-&gt;db-&gt;from('mytable'); <br />
$this-&gt;db-&gt;truncate(); <br />
// or <br />
$this-&gt;db-&gt;truncate('mytable'); <br />

<br />
// Produce:<br />
// TRUNCATE mytable <br />
</code>
<p class="important"><strong>Note:</strong> If the TRUNCATE command isn't available, truncate() will execute as &quot;DELETE FROM table&quot;.</p>
<h1><a name="chaining">&nbsp;</a>Method Chaining</h1>

<p>Method chaining allows you to simplify your syntax by connecting multiple functions.  Consider this example:</p>

<code>
<dfn>$this-&gt;db</dfn><kbd>-&gt;</kbd><var>select</var>('title')<kbd>-&gt;</kbd><var>from</var>('mytable')<kbd>-&gt;</kbd><var>where</var>('id', $id)<kbd>-&gt;</kbd><var>limit</var>(10, 20);<br />
<br />

$query = $this-&gt;db-&gt;get();</code>

<p class="important"><strong>Note:</strong> Method chaining only works with PHP 5.</p>

<p>&nbsp;</p>

<h1><a name="caching">&nbsp;</a>Active Record Caching</h1>
<p>While not &quot;true&quot; caching, Active Record enables you to save (or &quot;cache&quot;) certain parts of your queries for reuse later. Normally, when an Active Record call is completed, all stored information is reset for the next call. With caching, you can prevent this reset, and reuse information easily.</p>
<p>Cached calls are cumulative.  If you make 2 cached select() calls, and then 2 uncached select() calls, this will result in 4 select() calls. There are three Caching functions available:</p>
<h2>$this-&gt;db-&gt;start_cache()</h2>
<p>This function must be called to begin caching. All Active Record queries of the correct type (see below for supported queries) are stored for later use.</p>
<h2>$this-&gt;db-&gt;stop_cache()</h2>
<p>This function can be called to stop caching.</p>
<h2>$this-&gt;db-&gt;flush_cache()</h2>
<p>This function deletes all items from the Active Record cache.</p>
<p>Here's a usage example:</p>
<p><code>$this-&gt;db-&gt;start_cache();<br />
$this-&gt;db-&gt;select('field1');<br />
$this-&gt;db-&gt;stop_cache();<br />
$this-&gt;db-&gt;get('tablename');<br />
// Results in:<br />
// SELECT `field1` FROM (`tablename`)<br />
<br />
$this-&gt;db-&gt;select('field2');<br />
$this-&gt;db-&gt;get('tablename');<br />
// Results in:<br />
// SELECT `field1`, `field2` FROM (`tablename`)<br />
<br />
$this-&gt;db-&gt;flush_cache();<br />
<br />
$this-&gt;db-&gt;select('field2');<br />
$this-&gt;db-&gt;get('tablename');<br />
// Results in:<br />
// SELECT `field2` FROM (`tablename`)</code></p>
<p class="important"> <strong>Note:</strong> The following fields can be cached: ‘select’, ‘from’, ‘join’, ‘where’, ‘like’, ‘groupby’, ‘having’, ‘orderby’, ‘set’</p>
<p>&nbsp;</p><p>&nbsp;</p>
<div id="Contributors">
翻译贡献者:
aykirk, Hex, imjie, thankwsx</div>
<div id="DocDate">最后修改: 2008-08-27 22:48:43</div>
</div>
<!-- END CONTENT -->
<div id="footer">
  <p>
上一个主题:&nbsp;&nbsp;<a href="../database/helpers.html">查询辅助函数</a>&nbsp;&nbsp;&middot;&nbsp;&nbsp;<a href="#top">页首</a>
&nbsp;&middot;&nbsp;&nbsp;<a href="../index.html">用户指南首页</a>&nbsp;&nbsp;&middot;&nbsp;&nbsp;下一个主题:&nbsp;&nbsp;<a href="../database/transactions.html">事务</a>  </p>
  <p><a href="http://codeigniter.com" target="_blank">CodeIgniter</a> &nbsp;&middot;&nbsp; 版权所有 &#169; 2006-2008 &nbsp;&middot;&nbsp; <a href="http://ellislab.com/" target="_blank">Ellislab, Inc.</a></p>
  <p>中文化: <a href="http://codeigniter.org.cn" target="_blank">CodeIgniter 中国</a> &nbsp;&middot;&nbsp; 制作: Hex &nbsp;&middot;&nbsp; 生成日期: 2008-09-22 01:15</p>
</div>
</body>
</html>